<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SJC TOURNAMENT LIST</title>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
body{
background:#0b0b0f;
color:white;
font-family:sans-serif;
text-align:center;
margin:0;
}

.container{
Engine4141c;
padding:20px;
margin:15px auto;
border-radius:12px;
width:90%;
max-width:700px;
}

textarea{
width:90%;
padding:12px;
background:#1c1c24;
color:white;
border:none;
border-radius:8px;
}

button{
background:#e63946;
border:none;
padding:10px 15px;
margin:5px;
color:white;
border-radius:6px;
font-weight:bold;
}

#playerListBox{
max-height:300px;
overflow-y:auto;
margin-top:10px;
}

.playerRow{
background:#1c1c24;
margin:5px;
padding:8px;
display:flex;
justify-content:space-between;
border-radius:5px;
}

canvas{
width:90%;
max-width:350px;
margin:auto;
transition: transform 2s ease-out;
}

.arrow{
width:0;
height:0;
border-left:15px solid transparent;
border-right:15px solid transparent;
border-top:25px solid gold;
margin:auto;
}

.popup{
display:none;
position:fixed;
top:50%;
left:50%;
transform:translate(-50%,-50%) scale(0.5);
background:#e63946;
padding:20px 40px;
font-size:26px;
border-radius:12px;
transition:0.3s;
}
.popup.show{
display:block;
transform:translate(-50%,-50%) scale(1);
}

#slots{
max-height:300px;
overflow-y:auto;
margin-top:10px;
}

.slotCard{
background:#1c1c24;
margin:10px;
padding:12px;
border-radius:8px;
}

.vs{
color:red;
font-weight:bold;
}
</style>
</head>

<body onclick="enableSound()">

<h1>SJC TOURNAMENT SLOT</h1> 
<div class="container" id="setup">
<textarea id="names" placeholder="Enter players (one per line)"></textarea><br>
<button onclick="loadPlayers()">LOAD</button>
<button onclick="shufflePlayers()">SHUFFLE</button>
<button onclick="clearPlayers()">CLEAR</button>
<div id="playerListBox"></div>
<button onclick="start()">START DRAW</button>
</div>

<div class="container" id="draw" style="display:none">
<div class="arrow"></div>
<canvas id="wheelCanvas" width="350" height="350"></canvas>
<h3>Remaining: <span id="remain"></span></h3>
<button onclick="spin()">SPIN</button>
<button onclick="reset()">RESET</button>
<div id="slots"></div>
</div>

<div class="popup" id="popup"></div>

<audio id="spinSound" src="https://www.soundjay.com/mechanical/sounds/mechanical-clonk-1.mp3"></audio>
<audio id="popSound" src="https://www.soundjay.com/human/sounds/applause-8.mp3"></audio>

<script>

let players=[];
let slots=[];
let currentSlot=[];
let canvas=document.getElementById("wheelCanvas");
let ctx=canvas.getContext("2d");
let rotation=0;
let soundUnlocked=false;

let colors=["#ff0000","#ff7f00","#ffff00","#00ff00","#0000ff","#4b0082","#9400d3","#ff1493","#00ffff","#ffd700"];

function enableSound(){
if(!soundUnlocked){
document.getElementById("spinSound").play().catch(()=>{});
document.getElementById("spinSound").pause();
soundUnlocked=true;
}
}

function loadPlayers(){
players=document.getElementById("names").value.split("\n").filter(x=>x.trim()!="");
showPlayersUI();
drawWheel();
}

function showPlayersUI(){
let html="";
players.forEach((p,i)=>{
html+=`<div class="playerRow">${p}<button onclick="removePlayer(${i})">DEL</button></div>`;
});
document.getElementById("playerListBox").innerHTML=html;
}

function removePlayer(i){
players.splice(i,1);
showPlayersUI();
drawWheel();
}

function shufflePlayers(){
players.sort(()=>Math.random()-0.5);
showPlayersUI();
drawWheel();
}

function clearPlayers(){
players=[];
showPlayersUI();
drawWheel();
}

function start(){
if(players.length%2!=0){alert("Even players needed"); return;}
document.getElementById("setup").style.display="none";
document.getElementById("draw").style.display="block";
document.getElementById("remain").innerText=players.length;
drawWheel();
}

function drawWheel(){
if(players.length==0) return;
let angle=2*Math.PI/players.length;
ctx.clearRect(0,0,350,350);

players.forEach((p,i)=>{
ctx.beginPath();
ctx.moveTo(175,175);
ctx.arc(175,175,170,i*angle,(i+1)*angle);
ctx.fillStyle=colors[i%colors.length];
ctx.fill();

ctx.save();
ctx.translate(175,175);
ctx.rotate(i*angle+angle/2);
ctx.fillStyle="black";
ctx.font="bold 16px Arial";
ctx.textAlign="center";
ctx.fillText(p,110,5);
ctx.restore();
});
}

function spin(){

if(players.length==0) return;

let s=document.getElementById("spinSound");
s.currentTime=0;
s.play().catch(()=>{});

let spinAmount=Math.random()*720+720;
rotation+=spinAmount;
canvas.style.transform=`rotate(${rotation}deg)`;

setTimeout(()=>{

let index=Math.floor(Math.random()*players.length);
let selected=players[index];

showPopup(selected);

currentSlot.push(selected);
players.splice(index,1);
drawWheel();

if(currentSlot.length==2){
slots.push(currentSlot);
currentSlot=[];
showSlots();

document.getElementById("popSound").play().catch(()=>{});

confetti({
particleCount:200,
spread:120,
origin:{y:0.7}
});
}

document.getElementById("remain").innerText=players.length;

},2000);
}

function showPopup(name){
let pop=document.getElementById("popup");
pop.innerHTML="SELECTED<br>"+name;
pop.classList.add("show");

document.getElementById("popSound").play().catch(()=>{});

confetti({
particleCount:150,
spread:90,
origin:{y:0.6}
});

setTimeout(()=>pop.classList.remove("show"),2000);
}

function showSlots(){
let html="";
slots.forEach((s,i)=>{
html+=`<div class="slotCard">TEAM ${i+1}<br>${s[0]} <span class="vs">VS</span> ${s[1]}</div>`;
});
document.getElementById("slots").innerHTML=html;
}

function reset(){
location.reload();
}

</script>
</body>
</html>
